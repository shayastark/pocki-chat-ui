[Skip to content](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213#start-of-content)

You signed in with another tab or window. [Reload](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213) to refresh your session.You signed out in another tab or window. [Reload](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213) to refresh your session.You switched accounts on another tab or window. [Reload](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213) to refresh your session.Dismiss alert

{{ message }}

[xmtp](https://github.com/xmtp)/ **[xmtp-js](https://github.com/xmtp/xmtp-js)** Public

- [Notifications](https://github.com/login?return_to=%2Fxmtp%2Fxmtp-js) You must be signed in to change notification settings
- [Fork\\
74](https://github.com/login?return_to=%2Fxmtp%2Fxmtp-js)
- [Star\\
273](https://github.com/login?return_to=%2Fxmtp%2Fxmtp-js)


## File tree

Expand file treeCollapse file tree

## 8 files changed

+98

-4

lines changed

Open diff view settings

Filter options

- .changeset



  - [long-donkeys-exist.md](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213#diff-7f001e29a6f78ad5b0702f21839a8d94d413ce725693d9c6ed139e0b00834cdc)
- sdks



  - agent-sdk



    - [vitest.config.ts](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213#diff-143d7b26de662a68e99c53ae874c199f905743af7ccd435bc4d5b565011dbd58)
  - node-sdk



    - src



      - [index.ts](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213#diff-a799851ddab26b071b3e6753eb77936fa9fc3da7839b22d80d9f257177cdd070)

      - [types.ts](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213#diff-5ab8d64966cdd3ef2296dd75417e657434be92abe4cd0072322fa40832ab5485)

      - utils



        - [createClient.ts](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213#diff-384c4dfe50aecc407db2a90b34a4b35e41ddbafca70ca720f757f920439f76a3)

        - [validation.ts](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213#diff-9c61790ece8b2cba2252ca3348d149668866f50243f62b9f2e9be40c0d068ae8)
    - test



      - [Client.test.ts](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213#diff-c00658c71eee5bdefef8b17b8d65ffb08e066b43f77200db2e049e2e6f137442)

      - [validation.test.ts](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213#diff-ff7c582c96d218e671576e2691d1256af3e95f3af65e7bb441190186c80cbd9a)

Expand file treeCollapse file tree

## 8 files changed

+98

-4

lines changed

Open diff view settings

Collapse file

### [`‎.changeset/long-donkeys-exist.md‎`](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213\#diff-7f001e29a6f78ad5b0702f21839a8d94d413ce725693d9c6ed139e0b00834cdc)

Copy file name to clipboard

+6Lines changed: 6 additions & 0 deletions

- Display the source diff
- Display the rich diff

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| `@@ -0,0 +1,6 @@<br>` |
| `` | `1` | `+---<br>` |
| `` | `2` | `+"@xmtp/agent-sdk": patch<br>` |
| `` | `3` | `+"@xmtp/node-sdk": patch<br>` |
| `` | `4` | `+---<br>` |
| `` | `5` | `+<br>` |
| `` | `6` | `+Enable hex strings as database encryption keys<br>` |

Collapse file

### [`‎sdks/agent-sdk/vitest.config.ts‎`](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213\#diff-143d7b26de662a68e99c53ae874c199f905743af7ccd435bc4d5b565011dbd58)

Copy file name to clipboardExpand all lines: sdks/agent-sdk/vitest.config.ts

-1Lines changed: 0 additions & 1 deletion

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| `@@ -2,7 +2,6 @@ import tsconfigPaths from "vite-tsconfig-paths";<br>` |
| `2` | `2` | `import { defineConfig } from "vitest/config";<br>` |
| `3` | `3` | `<br>` |
| `4` | `4` | `export default defineConfig({<br>` |
| `5` | `` | `-  // @see https://github.com/aleclarson/vite-tsconfig-paths/issues/176<br>` |
| `6` | `5` | `  plugins: [tsconfigPaths()],<br>` |
| `7` | `6` | `  test: {<br>` |
| `8` | `7` | `    globals: true,<br>` |
| `<br>` |

Collapse file

### [`‎sdks/node-sdk/src/index.ts‎`](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213\#diff-a799851ddab26b071b3e6753eb77936fa9fc3da7839b22d80d9f257177cdd070)

Copy file name to clipboardExpand all lines: sdks/node-sdk/src/index.ts

+1Lines changed: 1 addition & 0 deletions

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| `@@ -59,4 +59,5 @@ export {<br>` |
| `59` | `59` | `export { generateInboxId, getInboxIdForIdentifier } from "./utils/inboxId";<br>` |
| `60` | `60` | `export type { Signer } from "./utils/signer";<br>` |
| `61` | `61` | `export * from "./utils/errors";<br>` |
| `` | `62` | `+export * from "./utils/validation";<br>` |
| `62` | `63` | `export type * from "./utils/streams";<br>` |

Collapse file

### [`‎sdks/node-sdk/src/types.ts‎`](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213\#diff-5ab8d64966cdd3ef2296dd75417e657434be92abe4cd0072322fa40832ab5485)

Copy file name to clipboardExpand all lines: sdks/node-sdk/src/types.ts

+9-2Lines changed: 9 additions & 2 deletions

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| `@@ -1,6 +1,7 @@<br>` |
| `1` | `1` | `import type { ContentCodec } from "@xmtp/content-type-primitives";<br>` |
| `2` | `2` | `import type { LogLevel } from "@xmtp/node-bindings";<br>` |
| `3` | `3` | `import type { ApiUrls } from "@/constants";<br>` |
| `` | `4` | `+import type { HexString } from "./utils/validation";<br>` |
| `4` | `5` | `<br>` |
| `5` | `6` | `/**<br>` |
| `6` | `7` | ` * XMTP environment<br>` |
| `@@ -13,6 +14,8 @@ export type XmtpEnv = keyof typeof ApiUrls;<br>` |
| `13` | `14` | `export type NetworkOptions = {<br>` |
| `14` | `15` | `  /**<br>` |
| `15` | `16` | ``   * Specify which XMTP environment to connect to. (default: `dev`)<br>`` |
| `` | `17` | `+   *<br>` |
| `` | `18` | `+   * @see https://docs.xmtp.org/chat-apps/core-messaging/create-a-client#xmtp-network-environments<br>` |
| `16` | `19` | `   */<br>` |
| `17` | `20` | `  env?: XmtpEnv;<br>` |
| `18` | `21` | `  /**<br>` |
| `@@ -23,6 +26,8 @@ export type NetworkOptions = {<br>` |
| `23` | `26` | `  /**<br>` |
| `24` | `27` | ``   * historySyncUrl can be used to override the `env` flag and connect to a<br>`` |
| `25` | `28` | `   * specific endpoint for syncing history<br>` |
| `` | `29` | `+   *<br>` |
| `` | `30` | `+   * @see https://docs.xmtp.org/chat-apps/list-stream-sync/history-sync<br>` |
| `26` | `31` | `   */<br>` |
| `27` | `32` | `  historySyncUrl?: string | null;<br>` |
| `28` | `33` | `};<br>` |
| `@@ -54,9 +59,11 @@ export type StorageOptions = {<br>` |
| `54` | `59` | `   */<br>` |
| `55` | `60` | `  dbPath?: string | null | ((inboxId: string) => string);<br>` |
| `56` | `61` | `  /**<br>` |
| `57` | `` | `-   * Encryption key for the local DB<br>` |
| `` | `62` | `+   * Encryption key for the local DB (32 bytes, hex)<br>` |
| `` | `63` | `+   *<br>` |
| `` | `64` | `+   * @see https://docs.xmtp.org/chat-apps/core-messaging/create-a-client#view-an-encrypted-database<br>` |
| `58` | `65` | `   */<br>` |
| `59` | `` | `-  dbEncryptionKey?: Uint8Array;<br>` |
| `` | `66` | `+  dbEncryptionKey?: Uint8Array | HexString;<br>` |
| `60` | `67` | `};<br>` |
| `61` | `68` | `<br>` |
| `62` | `69` | `export type ContentOptions = {<br>` |
| `<br>` |

Collapse file

### [`‎sdks/node-sdk/src/utils/createClient.ts‎`](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213\#diff-384c4dfe50aecc407db2a90b34a4b35e41ddbafca70ca720f757f920439f76a3)

Copy file name to clipboardExpand all lines: sdks/node-sdk/src/utils/createClient.ts

+6-1Lines changed: 6 additions & 1 deletion

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| `@@ -10,6 +10,7 @@ import {<br>` |
| `10` | `10` | `import { ApiUrls, HistorySyncUrls } from "@/constants";<br>` |
| `11` | `11` | `import type { ClientOptions } from "@/types";<br>` |
| `12` | `12` | `import { generateInboxId, getInboxIdForIdentifier } from "@/utils/inboxId";<br>` |
| `` | `13` | `+import { isHexString } from "./validation";<br>` |
| `13` | `14` | `<br>` |
| `14` | `15` | `export const createClient = async (<br>` |
| `15` | `16` | `  identifier: Identifier,<br>` |
| `@@ -46,13 +47,17 @@ export const createClient = async (<br>` |
| `46` | `47` | `    ? SyncWorkerMode.disabled<br>` |
| `47` | `48` | `    : SyncWorkerMode.enabled;<br>` |
| `48` | `49` | `<br>` |
| `` | `50` | `+  const dbEncryptionKey = isHexString(options?.dbEncryptionKey)<br>` |
| `` | `51` | `+    ? Buffer.from(options.dbEncryptionKey.replace(/^0x/, ""), "hex")<br>` |
| `` | `52` | `+    : options?.dbEncryptionKey;<br>` |
| `` | `53` | `+<br>` |
| `49` | `54` | `  return createNodeClient(<br>` |
| `50` | `55` | `    host,<br>` |
| `51` | `56` | `    isSecure,<br>` |
| `52` | `57` | `    dbPath,<br>` |
| `53` | `58` | `    inboxId,<br>` |
| `54` | `59` | `    identifier,<br>` |
| `55` | `` | `-    options?.dbEncryptionKey,<br>` |
| `` | `60` | `+    dbEncryptionKey,<br>` |
| `56` | `61` | `    historySyncUrl,<br>` |
| `57` | `62` | `    deviceSyncWorkerMode,<br>` |
| `58` | `63` | `    logOptions,<br>` |
| `<br>` |

Collapse file

### [`‎sdks/node-sdk/src/utils/validation.ts‎`](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213\#diff-9c61790ece8b2cba2252ca3348d149668866f50243f62b9f2e9be40c0d068ae8)

Copy file name to clipboard

+4Lines changed: 4 additions & 0 deletions

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| `@@ -0,0 +1,4 @@<br>` |
| `` | `1` | ``+export type HexString = `0x${string}`;<br>`` |
| `` | `2` | `+export function isHexString(value: unknown): value is HexString {<br>` |
| `` | `3` | `+  return typeof value === "string" && /^0x(?:[0-9a-fA-F]{2})+$/.test(value);<br>` |
| `` | `4` | `+}<br>` |

Collapse file

### [`‎sdks/node-sdk/test/Client.test.ts‎`](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213\#diff-c00658c71eee5bdefef8b17b8d65ffb08e066b43f77200db2e049e2e6f137442)

Copy file name to clipboardExpand all lines: sdks/node-sdk/test/Client.test.ts

+39Lines changed: 39 additions & 0 deletions

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| `@@ -536,4 +536,43 @@ describe("Client", () => {<br>` |
| `536` | `536` | ``    const database = path.join(baseDir, `user-${client.inboxId}.db3`);<br>`` |
| `537` | `537` | `    expect(fs.existsSync(database)).toBe(true);<br>` |
| `538` | `538` | `  });<br>` |
| `` | `539` | `+<br>` |
| `` | `540` | `+  it("should create a client without encryption key", async () => {<br>` |
| `` | `541` | `+    const user = createUser();<br>` |
| `` | `542` | `+    const signer = createSigner(user);<br>` |
| `` | `543` | `+<br>` |
| `` | `544` | `+    const client = await createRegisteredClient(signer, {<br>` |
| `` | `545` | ``+      dbPath: `./test-${v4()}.db3`,<br>`` |
| `` | `546` | `+    });<br>` |
| `` | `547` | `+<br>` |
| `` | `548` | `+    expect(client).toBeDefined();<br>` |
| `` | `549` | `+    expect(client.inboxId).toBeDefined();<br>` |
| `` | `550` | `+  });<br>` |
| `` | `551` | `+<br>` |
| `` | `552` | `+  it("should create a client with Uint8Array encryption key", async () => {<br>` |
| `` | `553` | `+    const user = createUser();<br>` |
| `` | `554` | `+    const signer = createSigner(user);<br>` |
| `` | `555` | `+    const encryptionKey = new Uint8Array(32).fill(1);<br>` |
| `` | `556` | `+<br>` |
| `` | `557` | `+    const client = await createRegisteredClient(signer, {<br>` |
| `` | `558` | ``+      dbPath: `./test-${v4()}.db3`,<br>`` |
| `` | `559` | `+      dbEncryptionKey: encryptionKey,<br>` |
| `` | `560` | `+    });<br>` |
| `` | `561` | `+<br>` |
| `` | `562` | `+    expect(client).toBeDefined();<br>` |
| `` | `563` | `+  });<br>` |
| `` | `564` | `+<br>` |
| `` | `565` | `+  it("should create a client with hex string encryption key with 0x prefix", async () => {<br>` |
| `` | `566` | `+    const user = createUser();<br>` |
| `` | `567` | `+    const signer = createSigner(user);<br>` |
| `` | `568` | `+    const encryptionKey =<br>` |
| `` | `569` | `+      "0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef";<br>` |
| `` | `570` | `+<br>` |
| `` | `571` | `+    const client = await createRegisteredClient(signer, {<br>` |
| `` | `572` | ``+      dbPath: `./test-${v4()}.db3`,<br>`` |
| `` | `573` | `+      dbEncryptionKey: encryptionKey,<br>` |
| `` | `574` | `+    });<br>` |
| `` | `575` | `+<br>` |
| `` | `576` | `+    expect(client).toBeDefined();<br>` |
| `` | `577` | `+  });<br>` |
| `539` | `578` | `});<br>` |

Collapse file

### [`‎sdks/node-sdk/test/validation.test.ts‎`](https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213\#diff-ff7c582c96d218e671576e2691d1256af3e95f3af65e7bb441190186c80cbd9a)

Copy file name to clipboard

+33Lines changed: 33 additions & 0 deletions

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| `@@ -0,0 +1,33 @@<br>` |
| `` | `1` | `+import { describe, expect, it } from "vitest";<br>` |
| `` | `2` | `+import { isHexString } from "@/utils/validation";<br>` |
| `` | `3` | `+<br>` |
| `` | `4` | `+describe("isHexString", () => {<br>` |
| `` | `5` | `+  it("returns true for valid hex strings", () => {<br>` |
| `` | `6` | `+    const valid = [<br>` |\
| `` | `7` | `+      "0xab",<br>` |\
| `` | `8` | `+      "0xabcd",<br>` |\
| `` | `9` | `+      "0xABCD",<br>` |\
| `` | `10` | `+      "0x0123456789abcdefABCDEF",<br>` |\
| `` | `11` | `+    ] as const;<br>` |
| `` | `12` | `+<br>` |
| `` | `13` | `+    for (const value of valid) {<br>` |
| `` | `14` | `+      expect(isHexString(value)).toBe(true);<br>` |
| `` | `15` | `+    }<br>` |
| `` | `16` | `+  });<br>` |
| `` | `17` | `+<br>` |
| `` | `18` | `+  it("returns false for invalid hex strings", () => {<br>` |
| `` | `19` | `+    const invalid = ["0x", "123", "0xg", "0X123", "0x123"] as const;<br>` |
| `` | `20` | `+<br>` |
| `` | `21` | `+    for (const value of invalid) {<br>` |
| `` | `22` | `+      expect(isHexString(value)).toBe(false);<br>` |
| `` | `23` | `+    }<br>` |
| `` | `24` | `+  });<br>` |
| `` | `25` | `+<br>` |
| `` | `26` | `+  it("returns false for non-string values", () => {<br>` |
| `` | `27` | `+    const invalid = [123, null, undefined, {}, []] as const;<br>` |
| `` | `28` | `+<br>` |
| `` | `29` | `+    for (const value of invalid) {<br>` |
| `` | `30` | `+      expect(isHexString(value)).toBe(false);<br>` |
| `` | `31` | `+    }<br>` |
| `` | `32` | `+  });<br>` |
| `` | `33` | `+});<br>` |

## 0 commit comments

Comments

0 (0)

Please [sign in](https://github.com/login?return_to=https://github.com/xmtp/xmtp-js/commit/9003bb9dd6544ae19f9eb3ab2b19a029d8764213) to comment.

You can’t perform that action at this time.