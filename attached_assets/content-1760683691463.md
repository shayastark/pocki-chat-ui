[Skip to content](https://github.com/xmtp/xmtp-js/blob/main/sdks/agent-sdk/src/core/filter.ts#start-of-content)

You signed in with another tab or window. [Reload](https://github.com/xmtp/xmtp-js/blob/main/sdks/agent-sdk/src/core/filter.ts) to refresh your session.You signed out in another tab or window. [Reload](https://github.com/xmtp/xmtp-js/blob/main/sdks/agent-sdk/src/core/filter.ts) to refresh your session.You switched accounts on another tab or window. [Reload](https://github.com/xmtp/xmtp-js/blob/main/sdks/agent-sdk/src/core/filter.ts) to refresh your session.Dismiss alert

{{ message }}

[xmtp](https://github.com/xmtp)/ **[xmtp-js](https://github.com/xmtp/xmtp-js)** Public

- [Notifications](https://github.com/login?return_to=%2Fxmtp%2Fxmtp-js) You must be signed in to change notification settings
- [Fork\\
71](https://github.com/login?return_to=%2Fxmtp%2Fxmtp-js)
- [Star\\
263](https://github.com/login?return_to=%2Fxmtp%2Fxmtp-js)


## Collapse file tree

## Files

main

Search this repository

/

# filter.ts

Copy path

BlameMore file actions

BlameMore file actions

## Latest commit

## History

[History](https://github.com/xmtp/xmtp-js/commits/main/sdks/agent-sdk/src/core/filter.ts)

[View commit history for this file.](https://github.com/xmtp/xmtp-js/commits/main/sdks/agent-sdk/src/core/filter.ts)

123 lines (108 loc) · 3 KB

/

# filter.ts

Top

## File metadata and controls

- Code

- Blame


123 lines (108 loc) · 3 KB

[Raw](https://github.com/xmtp/xmtp-js/raw/refs/heads/main/sdks/agent-sdk/src/core/filter.ts)

Copy raw file

Download raw file

You must be signed in to make or propose changes

More edit options

Open symbols panel

Edit and raw actions

import {
ContentTypeGroupUpdated,
type GroupUpdatedCodec,
} from "@xmtp/content-type-group-updated";
import {
ContentTypeReaction,
type ReactionCodec,
} from "@xmtp/content-type-reaction";
import {
ContentTypeRemoteAttachment,
type RemoteAttachmentCodec,
} from "@xmtp/content-type-remote-attachment";
import { ContentTypeReply, type ReplyCodec } from "@xmtp/content-type-reply";
import { ContentTypeText, type TextCodec } from "@xmtp/content-type-text";
import {
Dm,
Group,
type Client,
type Conversation,
type DecodedMessage,
} from "@xmtp/node-sdk";

export type DecodedMessageWithContent<ContentTypes = unknown> =
DecodedMessage<ContentTypes> & {
content: ContentTypes;
};

const fromSelf = <ContentTypes>(
message: DecodedMessage<ContentTypes>,
client: Client<ContentTypes>,
) =\> {
return message.senderInboxId === client.inboxId;
};

const hasContent = <ContentTypes>(
message: DecodedMessage<ContentTypes>,
): message is DecodedMessageWithContent<ContentTypes> => {
return message.content !== undefined && message.content !== null;
};

const isDM = (conversation: Conversation): conversation is Dm => {
return conversation instanceof Dm;
};

const isGroup = (conversation: Conversation): conversation is Group => {
return conversation instanceof Group;
};

const isGroupAdmin = (conversation: Conversation, message: DecodedMessage) => {
if (isGroup(conversation)) {
return conversation.isAdmin(message.senderInboxId);
}
return false;
};

const isGroupSuperAdmin = (
conversation: Conversation,
message: DecodedMessage,
) =\> {
if (isGroup(conversation)) {
return conversation.isSuperAdmin(message.senderInboxId);
}
return false;
};

const isGroupUpdate = (
message: DecodedMessage,
): message is DecodedMessage & {
content: ReturnType<GroupUpdatedCodec\["decode"\]>;
} =\> {
return !!message.contentType?.sameAs(ContentTypeGroupUpdated);
};

const isReaction = (
message: DecodedMessage,
): message is DecodedMessage & {
content: ReturnType<ReactionCodec\["decode"\]>;
} =\> {
return !!message.contentType?.sameAs(ContentTypeReaction);
};

const isReply = (
message: DecodedMessage,
): message is DecodedMessage & {
content: ReturnType<ReplyCodec\["decode"\]>;
} =\> {
return !!message.contentType?.sameAs(ContentTypeReply);
};

const isRemoteAttachment = (
message: DecodedMessage,
): message is DecodedMessage & {
content: ReturnType<RemoteAttachmentCodec\["decode"\]>;
} =\> {
return !!message.contentType?.sameAs(ContentTypeRemoteAttachment);
};

const isText = (
message: DecodedMessage,
): message is DecodedMessageWithContent<ReturnType<TextCodec\["decode"\]>> => {
return !!message.contentType?.sameAs(ContentTypeText);
};

const isTextReply = (message: DecodedMessage) => {
return isReply(message) && typeof message.content.content === "string";
};

export const filter = {
fromSelf,
hasContent,
isDM,
isGroup,
isGroupAdmin,
isGroupSuperAdmin,
isGroupUpdate,
isReaction,
isRemoteAttachment,
isReply,
isText,
isTextReply,
};

export const f = filter;

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

26

27

28

29

30

31

32

33

34

35

36

37

38

39

40

41

42

43

44

45

46

47

48

49

50

51

52

53

54

55

56

57

58

59

60

61

62

63

64

65

66

67

68

69

70

71

72

73

74

75

76

77

78

79

80

81

82

83

84

85

86

87

88

89

90

91

92

93

94

95

96

97

98

99

100

101

102

103

104

105

106

107

108

109

110

111

112

113

114

115

116

117

118

119

120

121

122

123

import{

ContentTypeGroupUpdated,

typeGroupUpdatedCodec,

}from"@xmtp/content-type-group-updated";

import{

ContentTypeReaction,

typeReactionCodec,

}from"@xmtp/content-type-reaction";

import{

ContentTypeRemoteAttachment,

typeRemoteAttachmentCodec,

}from"@xmtp/content-type-remote-attachment";

import{ContentTypeReply,typeReplyCodec}from"@xmtp/content-type-reply";

import{ContentTypeText,typeTextCodec}from"@xmtp/content-type-text";

import{

Dm,

Group,

typeClient,

typeConversation,

typeDecodedMessage,

}from"@xmtp/node-sdk";

exporttypeDecodedMessageWithContent<ContentTypes=unknown>=

DecodedMessage<ContentTypes>&{

content: ContentTypes;

};

constfromSelf=<ContentTypes>(

message: DecodedMessage<ContentTypes>,

client: Client<ContentTypes>,

)=>{

returnmessage.senderInboxId===client.inboxId;

};

consthasContent=<ContentTypes>(

message: DecodedMessage<ContentTypes>,

): message is DecodedMessageWithContent<ContentTypes>=>{

returnmessage.content!==undefined&&message.content!==null;

};

constisDM=(conversation: Conversation): conversation is Dm=>{

returnconversationinstanceofDm;

};

constisGroup=(conversation: Conversation): conversation is Group=>{

returnconversationinstanceofGroup;

};

constisGroupAdmin=(conversation: Conversation,message: DecodedMessage)=>{

if(isGroup(conversation)){

returnconversation.isAdmin(message.senderInboxId);

}

returnfalse;

};

constisGroupSuperAdmin=(

conversation: Conversation,

message: DecodedMessage,

)=>{

if(isGroup(conversation)){

returnconversation.isSuperAdmin(message.senderInboxId);

}

returnfalse;

};

constisGroupUpdate=(

message: DecodedMessage,

): message is DecodedMessage&{

content: ReturnType<GroupUpdatedCodec\["decode"\]>;

}=>{

return!!message.contentType?.sameAs(ContentTypeGroupUpdated);

};

constisReaction=(

message: DecodedMessage,

): message is DecodedMessage&{

content: ReturnType<ReactionCodec\["decode"\]>;

}=>{

return!!message.contentType?.sameAs(ContentTypeReaction);

};

constisReply=(

message: DecodedMessage,

): message is DecodedMessage&{

content: ReturnType<ReplyCodec\["decode"\]>;

}=>{

return!!message.contentType?.sameAs(ContentTypeReply);

};

constisRemoteAttachment=(

message: DecodedMessage,

): message is DecodedMessage&{

content: ReturnType<RemoteAttachmentCodec\["decode"\]>;

}=>{

return!!message.contentType?.sameAs(ContentTypeRemoteAttachment);

};

constisText=(

message: DecodedMessage,

): message is DecodedMessageWithContent<ReturnType<TextCodec\["decode"\]>>=>{

return!!message.contentType?.sameAs(ContentTypeText);

};

constisTextReply=(message: DecodedMessage)=>{

returnisReply(message)&&typeofmessage.content.content==="string";

};

exportconstfilter={

fromSelf,

hasContent,

isDM,

isGroup,

isGroupAdmin,

isGroupSuperAdmin,

isGroupUpdate,

isReaction,

isRemoteAttachment,

isReply,

isText,

isTextReply,

};

exportconstf=filter;

You can’t perform that action at this time.